{"type":"file","encoding":"base64","size":4306,"name":"light_engine.dart","path":"lib/utils/light_engine.dart","content":"aW1wb3J0ICdkYXJ0OmFzeW5jJzsKaW1wb3J0ICdwYWNrYWdlOmZsdXR0ZXIvbWF0ZXJpYWwuZGFydCc7CmltcG9ydCAncGFja2FnZTpmbHV0dGVyL2ZvdW5kYXRpb24uZGFydCcgc2hvdyByZXF1aXJlZDsKaW1wb3J0ICdib29rX2RlY29kZXIuZGFydCc7CmltcG9ydCAnLi4vc2VydmljZXMvc3lzdGVtLmRhcnQnOwppbXBvcnQgJy4uL3NlcnZpY2VzL2Jvb2suZGFydCc7CmltcG9ydCAnLi4vbW9kZWxzL2Jvb2suZGFydCc7CmltcG9ydCAnLi4vbW9kZWxzL3BhZ2luYXRpb24uZGFydCc7CmltcG9ydCAnLi4vbW9kZWxzL3N0eWxlLmRhcnQnOwppbXBvcnQgJy4uL21vZGVscy9zZWN0aW9uLmRhcnQnOwppbXBvcnQgJy4uL3V0aWxzL3BhZ2luZy5kYXJ0JzsKCmNsYXNzIExpZ2h0RW5naW5lIHsKICBzdGF0aWMgTWFwPEJvb2ssIExpZ2h0RW5naW5lPiBfY2FjaGU7CgogIC8vLyB1c2VkIHRvIHJlc2V0IHN0YXRlCiAgZmluYWwgVmFsdWVDaGFuZ2VkPFZvaWRDYWxsYmFjaz4gX3N0YXRlU2V0dGVyOwoKICBmYWN0b3J5IExpZ2h0RW5naW5lKAogICAgICB7QHJlcXVpcmVkIEJvb2sgYm9vaywgQHJlcXVpcmVkIFZhbHVlQ2hhbmdlZDxWb2lkQ2FsbGJhY2s+IHN0YXRlU2V0dGVyfSkgewovLyAgICBpZiAobnVsbCA9PSBfY2FjaGUpIHsKICAgIF9jYWNoZSA9IDxCb29rLCBMaWdodEVuZ2luZT57fTsKLy8gICAgfQogICAgaWYgKCFfY2FjaGUuY29udGFpbnNLZXkoYm9vaykpIHsKICAgICAgX2NhY2hlW2Jvb2tdID0KICAgICAgICAgIG5ldyBMaWdodEVuZ2luZS5faW50ZXJuYWwoYm9vazogYm9vaywgc3RhdGVTZXR0ZXI6IHN0YXRlU2V0dGVyKTsKICAgIH0KICAgIHJldHVybiBfY2FjaGVbYm9va107CiAgfQoKICBmaW5hbCBCb29rIF9ib29rOwoKICBmaW5hbCBTeXN0ZW1TZXJ2aWNlIF9zZXJ2aWNlID0gbmV3IFN5c3RlbVNlcnZpY2UoKTsKCiAgU3RyZWFtU3Vic2NyaXB0aW9uIF9zdHJlYW1TdWJzY3JpcHRpb247CgogIFN0eWxlIF9zdHlsZTsKCiAgTGlnaHRFbmdpbmUuX2ludGVybmFsKHtCb29rIGJvb2ssIFZhbHVlQ2hhbmdlZDxWb2lkQ2FsbGJhY2s+IHN0YXRlU2V0dGVyfSkKICAgICAgOiBhc3NlcnQobnVsbCAhPSBib29rKSwKICAgICAgICBhc3NlcnQobnVsbCAhPSBzdGF0ZVNldHRlciksCiAgICAgICAgX2Jvb2sgPSBib29rLAogICAgICAgIF9zdGF0ZVNldHRlciA9IHN0YXRlU2V0dGVyIHsKICAgIF9zdHJlYW1TdWJzY3JpcHRpb24gPSBfc2VydmljZS5saXN0ZW4oX2xpc3RlbmVyKTsKICB9CgogIHZvaWQgX2xpc3RlbmVyKHZhciBldmVudCkgewogICAgaWYgKG51bGwgIT0gZXZlbnQgJiYgZXZlbnQgaXMgTGlzdCAmJiBldmVudC5pc05vdEVtcHR5KSB7CiAgICAgIHN3aXRjaCAoZXZlbnRbMF0pIHsKICAgICAgICBjYXNlICcnOgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CgogIFBhZ2VDb250cm9sbGVyIF9wYWdlQ29udHJvbGxlcjsKCiAgQm9va0RlY29kZXIgX2RlY29kZXI7CgogIC8vLyBQcm92aWRlIFtQYWdlQ29udHJvbGxlcl0gdG8gW1JlYWRlcl0KICAvLy8KICAvLy8gV2hlbiB0aGVyZSBpcyBwYWdlQ29udHJvbGxlciBhbHJlYWR5LCByZXR1cm4gaXQuCiAgLy8vIElmIG5vdCwgZmlyc3QgZGVjb2RlIHRoZSBib29rLCBnZXQgYWxsIGNvbnRlbnQgb2YgdGhlIGJvb2ssCiAgLy8vIG5leHQgaW5pdGlhbGl6ZSBbU3R5bGVdLCB1c2VkIHRvIGRpc3BsYXksIGNhbGN1bGF0ZSBwYWdpbmcgZGF0YSwKICAvLy8gdGhlbiBnZXQgW1BhZ2luYXRpb25dLCB3aGljaCBtYXkgc3RhcnQgYSBzZWNvbmQgaXNvbGF0ZSB0byBjYWxjdWxhdGUgcGFnaW5nIGRhdGEsCiAgLy8vIGZpbmFsbHkgaW5zdGFudGlhdGUgUGFnZUNvbnRyb2xsZXIgYW5kIHJldHVybiBpdC4KICBGdXR1cmU8UGFnZUNvbnRyb2xsZXI+IGdldCBjb250cm9sbGVyIGFzeW5jIHsKICAgIHByaW50KCdnZXQgY29udHJvbGxlcicpOwogICAgdHJ5IHsKICAgICAgaWYgKG51bGwgPT0gX3BhZ2VDb250cm9sbGVyKSB7CiAgICAgICAgaWYgKG51bGwgPT0gX2RlY29kZXIpIHsKICAgICAgICAgIF9kZWNvZGVyID0gYXdhaXQgQm9va0RlY29kZXIuZGVjb2RlKF9ib29rKTsKICAgICAgICB9CiAgICAgICAgcHJpbnQoJ2ZsYWcxJyk7CiAgICAgICAgaWYgKG51bGwgPT0gU3R5bGUudmFsdWVzKSB7CiAgICAgICAgICBhd2FpdCBTdHlsZS5pbml0KCk7CiAgICAgICAgfQogICAgICAgIHByaW50KCdmbGFnMicpOwogICAgICAgIGlmIChudWxsID09IF9wYWdpbmF0aW9uKSB7CiAgICAgICAgICBfcGFnaW5hdGlvbiA9IG5ldyBQYWdpbmF0aW9uKAogICAgICAgICAgICAgIGJvb2s6IF9ib29rLAogICAgICAgICAgICAgIGJvb2tEZWNvZGVyOiBfZGVjb2RlciwKICAgICAgICAgICAgICBzaXplOiBfcGFnZVNpemUpOwogICAgICAgICAgX3BhZ2luYXRpb24uaW5pdChwYWdpbmdIYXNoQ29kZSk7CiAgICAgICAgfQogICAgICAgIF9wYWdlQ29udHJvbGxlciA9IG5ldyBQYWdlQ29udHJvbGxlcigpOwogICAgICB9CiAgICAgIHJldHVybiBfcGFnZUNvbnRyb2xsZXI7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHByaW50KCdnZXQgY29udHJvbGxlciBmYWlsZWQuIGVycm9yOiAkZScpOwogICAgICB0aHJvdyBlOwogICAgfQogIH0KCiAgTGlzdDxTdHlsZT4gZ2V0IHN0eWxlcyA9PiBTdHlsZS52YWx1ZXM7CgogIFN0eWxlIGdldCBzdHlsZSB7CiAgICByZXR1cm4gU3R5bGUudmFsdWVzW1N0eWxlLmN1cnJlbnRJZF07CiAgfQoKICBpbnQgY2hpbGRDb3VudCA9IDIwOwoKICBTdHJpbmcgZ2V0IHRpdGxlIHsKICAgIHJldHVybiAndGl0bGUuLi4nOwogIH0KCiAgUGFnaW5hdGlvbiBfcGFnaW5hdGlvbjsKCiAgU2VjdGlvbiBzZWN0aW9uOwoKICBTdHJpbmcgZ2V0Q29udGVudChpbnQgaW5kZXgpIHsKICAgIHRyeSB7CiAgICAgIHByaW50KCdnZXQgY29udGVudCBpbmRleD0kaW5kZXgnKTsKICAgICAgdmFyIHBhZ2UgPSBfcGFnaW5hdGlvbltpbmRleF07CiAgICAgIHNlY3Rpb24gPSBfZGVjb2Rlci5nZXRTZWN0aW9uKHBhZ2VbMF0sIHBhZ2VbMV0pOwogICAgICBpZiAobnVsbCA9PSBzZWN0aW9uKSB7CiAgICAgICAgcmV0dXJuICdnZXQgc2VjdGlvbiBlcnJvci4nOwogICAgICB9CiAgICAgIHJldHVybiBzZWN0aW9uLmNvbnRlbnQ7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHByaW50KCdnZXQgY29udGVudCBlcnJvcjogJGUnKTsKICAgICAgcmV0dXJuIGUudG9TdHJpbmcoKTsKICAgIH0KICB9CgogIFNpemUgX3BhZ2VTaXplOwoKICBTdHJpbmcgX3BhZ2luZ0hhc2hDb2RlOwoKICBTdHJpbmcgX3BhaW50SGFzaENvZGU7CgogIFN0cmluZyBnZXQgcGFnaW5nSGFzaENvZGUgewogICAgcmV0dXJuIGhhc2hWYWx1ZXMoX3BhZ2VTaXplLCBmb250U2l6ZSwgbGluZUhlaWdodCwgdGV4dERpcmVjdGlvbi50b1N0cmluZygpKQogICAgICAgIC50b1N0cmluZygpOwogIH0KCiAgZG91YmxlIGdldCBmb250U2l6ZSA9PiBTdHlsZS5mb250U2l6ZTsKCiAgZG91YmxlIGdldCBsaW5lSGVpZ2h0ID0+IFN0eWxlLmhlaWdodDsKCiAgVGV4dERpcmVjdGlvbiBnZXQgdGV4dERpcmVjdGlvbiA9PiBTdHlsZS50ZXh0RGlyZWN0aW9uOwoKICAvLy8gV2hlbiBzZXQgYSBuZXcgU2l6ZSwgY2hlY2sgdGhlIHBhZ2luZ0hhc2hDb2RlLAogIC8vLyByZWNhbGN1bGF0ZSBwYWdpbmF0aW9uIGlmIG5lZWQuCiAgc2V0IHBhZ2VTaXplKFNpemUgc2l6ZSkgewogICAgYXNzZXJ0KG51bGwgIT0gc2l6ZSk7CiAgICBwcmludCgnc2V0IHBhZ2Ugc2l6ZTogJHNpemUnKTsKICAgIGlmIChudWxsICE9IF9wYWdlU2l6ZSB8fCBzaXplID09IF9wYWdlU2l6ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBfcGFnZVNpemUgPSBzaXplOwogICAgX3BhZ2luYXRpb24/LmNoZWNrKHBhZ2luZ0hhc2hDb2RlKTsKICB9CgogIC8vLyBnZXQgdGhlIG1heCBsaW5lcyBmcm9tIFBhZ2luYXRpb24KICBpbnQgZ2V0IG1heExpbmVzID0+IF9wYWdpbmF0aW9uLm1heExpbmVzOwoKICBpbnQgZ2V0IGVzdGltYXRlTWF4TGluZXMgewogICAgcmV0dXJuIF9wYWdlU2l6ZS5oZWlnaHQgfi8gKGZvbnRTaXplICogbGluZUhlaWdodCk7CiAgfQoKICB2b2lkIF9pbml0U3RhdGUoKSB7fQoKICB2b2lkIF9zZXRTdGF0ZSgpIHsKICAgIF9zdGF0ZVNldHRlcigoKSB7fSk7CiAgfQoKICAvLy8gY2FsY3VsYXRlIHRoZSBoYXNoQ29kZSB0byBqdXN0IHdoZXRoZXIgdG8gcmVwYWludAogIHZvaWQgX25lZWRSZXBhaW50KCkge30KCiAgdm9pZCBjbG9zZSgpIHsKICAgIF9zdHJlYW1TdWJzY3JpcHRpb24/LmNhbmNlbCgpOwogICAgX2NhY2hlW19ib29rXSA9IG51bGw7CiAgfQp9Cg==","sha":"2fd1ef56bb16b4e21925c56463fd55c06f6b1c73","url":"https://gitee.com/api/v5/repos/tianshuapp/light/contents/lib/utils/light_engine.dart","html_url":"https://gitee.com/tianshuapp/light/blob/master/lib/utils/light_engine.dart","download_url":"https://gitee.com/tianshuapp/light/raw/master/lib/utils/light_engine.dart","_links":{"self":"https://gitee.com/api/v5/repos/tianshuapp/light/contents/lib/utils/light_engine.dart","html":"https://gitee.com/tianshuapp/light/blob/master/lib/utils/light_engine.dart"}}